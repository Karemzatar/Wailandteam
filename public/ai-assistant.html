<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wailand AI - Security Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
            color: #e6e6ff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: rgba(25, 25, 45, 0.9);
            border-radius: 20px;
            border: 1px solid rgba(122, 130, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, rgba(122, 130, 255, 0.1), rgba(59, 209, 255, 0.1));
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #7a82ff, #3bd1ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 8px 25px rgba(122, 130, 255, 0.4);
        }

        .title-section h1 {
            font-size: 2.2rem;
            background: linear-gradient(45deg, #7a82ff, #3bd1ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .title-section .subtitle {
            color: #a0a0d0;
            font-size: 1rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .language-switcher {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: #a0a0d0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .lang-btn.active {
            background: linear-gradient(45deg, #7a82ff, #3bd1ff);
            color: white;
            box-shadow: 0 4px 15px rgba(122, 130, 255, 0.3);
        }

        .feature-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #a0a0d0;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .feature-btn:hover {
            background: rgba(122, 130, 255, 0.1);
            color: #7a82ff;
            border-color: rgba(122, 130, 255, 0.3);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(46, 213, 115, 0.3);
        }

        .chat-container {
            height: 500px;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #7a82ff, #3bd1ff);
            border-radius: 3px;
        }

        .message {
            max-width: 80%;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
        }

        .message.ai {
            align-self: flex-start;
        }

        .message-bubble {
            padding: 18px 22px;
            border-radius: 20px;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .user .message-bubble {
            background: linear-gradient(135deg, #7a82ff, #5a62df);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .ai .message-bubble {
            background: rgba(59, 209, 255, 0.15);
            border: 1px solid rgba(59, 209, 255, 0.3);
            border-bottom-left-radius: 5px;
            color: #e6e6ff;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .user .message-avatar {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .ai .message-avatar {
            background: rgba(59, 209, 255, 0.3);
            color: #3bd1ff;
        }

        .message-sender {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user .message-sender {
            color: rgba(255, 255, 255, 0.9);
        }

        .ai .message-sender {
            color: #3bd1ff;
        }

        .message-content {
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .message-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .message-content li {
            margin-bottom: 5px;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 22px;
            background: rgba(59, 209, 255, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(59, 209, 255, 0.2);
            align-self: flex-start;
            max-width: 120px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #3bd1ff;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingBounce {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-5px);
                opacity: 1;
            }
        }

        .input-section {
            padding: 25px 30px;
            background: rgba(15, 15, 35, 0.6);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-container {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .chat-input {
            width: 100%;
            padding: 18px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: #e6e6ff;
            font-size: 1rem;
            resize: none;
            min-height: 60px;
            max-height: 120px;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: #7a82ff;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(122, 130, 255, 0.2);
        }

        .chat-input::placeholder {
            color: #7a7aaa;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .quick-action {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #a0a0d0;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: rgba(122, 130, 255, 0.1);
            color: #7a82ff;
            border-color: rgba(122, 130, 255, 0.3);
        }

        .send-button {
            background: linear-gradient(45deg, #7a82ff, #3bd1ff);
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(122, 130, 255, 0.3);
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(122, 130, 255, 0.4);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
            border: 1px solid rgba(46, 213, 115, 0.3);
        }

        .translation-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.7rem;
            margin-left: 8px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .chat-container {
                height: 400px;
                padding: 20px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .input-section {
                padding: 20px;
            }
            
            .input-container {
                flex-direction: column;
            }
            
            .send-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="title-section">
                        <h1>Wailand AI Assistant</h1>
                        <div class="subtitle">Advanced Cybersecurity & Multilingual Support</div>
                    </div>
                </div>
                <div class="controls">
                    <div class="language-switcher">
                        <button class="lang-btn active" onclick="switchLanguage('en')">
                            <i class="fas fa-globe"></i> EN
                        </button>
                        <button class="lang-btn" onclick="switchLanguage('ar')">
                            <i class="fas fa-globe"></i> AR
                        </button>
                    </div>
                    <button class="feature-btn" onclick="toggleTranslation()">
                        <i class="fas fa-language"></i>
                        <span id="translationStatus">Auto Translate</span>
                    </button>
                </div>
            </div>
            <div class="status-indicator">
                <i class="fas fa-circle"></i>
                <span id="statusText">AI Security Expert - Online</span>
            </div>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="message ai">
                <div class="message-bubble">
                    <div class="message-header">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-sender">Wailand Security AI</div>
                        <div class="security-badge">
                            <i class="fas fa-shield-alt"></i>
                            Verified
                        </div>
                    </div>
                    <div class="message-content">
                        <p>Welcome to <strong>Wailand Security AI Assistant</strong>! ğŸ›¡ï¸</p>
                        <p>I'm your dedicated cybersecurity expert with multilingual support. I can:</p>
                        <ul>
                            <li>Communicate in both English and Arabic</li>
                            <li>Translate security content automatically</li>
                            <li>Analyze threats and vulnerabilities</li>
                            <li>Provide security recommendations</li>
                            <li>Explain complex security concepts</li>
                        </ul>
                        <p>You can switch languages anytime using the buttons above!</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="input-section">
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="aiInput" 
                        placeholder="Type your message in any language..."
                        rows="1"
                    ></textarea>
                    <div class="quick-actions">
                        <div class="quick-action" onclick="quickAction('threat analysis')">
                            ğŸ” Threat Analysis
                        </div>
                        <div class="quick-action" onclick="quickAction('vulnerability scan')">
                            ğŸ›¡ï¸ Vulnerability Scan
                        </div>
                        <div class="quick-action" onclick="quickAction('translate this')">
                            ğŸŒ Translate Text
                        </div>
                        <div class="quick-action" onclick="quickAction('explain security')">
                            ğŸ’¡ Explain Security
                        </div>
                    </div>
                </div>
                <button class="send-button" onclick="sendMessage()" id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                    <span id="sendText">Send</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            apiKey: "AIzaSyCC6-8v-AIzaSyCC6-8v-FP8eX44UkqzICPso0icdt_Ozdg",
            model: "gemini-2.0-flash",
            autoTranslate: true
        };

        // Language and translation system
        const TRANSLATIONS = {
            en: {
                status: "AI Security Expert - Online",
                placeholder: "Type your message in any language...",
                send: "Send",
                autoTranslate: "Auto Translate",
                quickActions: {
                    threat: "Threat Analysis",
                    vulnerability: "Vulnerability Scan", 
                    translate: "Translate Text",
                    explain: "Explain Security"
                },
                welcome: `Welcome to <strong>Wailand Security AI Assistant</strong>! ğŸ›¡ï¸

I'm your dedicated cybersecurity expert with multilingual support. I can:

â€¢ Communicate in both English and Arabic
â€¢ Translate security content automatically  
â€¢ Analyze threats and vulnerabilities
â€¢ Provide security recommendations
â€¢ Explain complex security concepts

You can switch languages anytime using the buttons above!`
            },
            ar: {
                status: "Ø®Ø¨ÙŠØ± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ - Ù…ØªØµÙ„",
                placeholder: "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ø£ÙŠ Ù„ØºØ©...",
                send: "Ø¥Ø±Ø³Ø§Ù„",
                autoTranslate: "ØªØ±Ø¬Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©",
                quickActions: {
                    threat: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª",
                    vulnerability: "ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª",
                    translate: "ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†Øµ", 
                    explain: "Ø´Ø±Ø­ Ø§Ù„Ø£Ù…Ø§Ù†"
                },
                welcome: `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ <strong>Ù…Ø³Ø§Ø¹Ø¯ Wailand Ø§Ù„Ø£Ù…Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠ</strong>! ğŸ›¡ï¸

Ø£Ù†Ø§ Ø®Ø¨ÙŠØ±Ùƒ Ø§Ù„Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù…Ø¹ Ø¯Ø¹Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª. ÙŠÙ…ÙƒÙ†Ù†ÙŠ:

â€¢ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¨Ø§Ù„Ù„ØºØªÙŠÙ† Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ©
â€¢ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ù…Ù†ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
â€¢ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª ÙˆØ§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©
â€¢ ØªÙ‚Ø¯ÙŠÙ… ØªÙˆØµÙŠØ§Øª Ø£Ù…Ù†ÙŠØ© Ù…Ø®ØµØµØ©
â€¢ Ø´Ø±Ø­ Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©

ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰!`
            }
        };

        // Application state
        let currentLanguage = 'en';
        let autoTranslate = true;
        let chatHistory = [];

        // Initialize the application
        function initializeApp() {
            updateUI();
            document.getElementById('aiInput').focus();
            console.log("ğŸš€ Wailand AI Assistant initialized with multilingual support");
        }

        // Switch between languages
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // Update language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateUI();
        }

        // Toggle auto-translation
        function toggleTranslation() {
            autoTranslate = !autoTranslate;
            const statusElement = document.getElementById('translationStatus');
            statusElement.textContent = autoTranslate ? 
                TRANSLATIONS[currentLanguage].autoTranslate : 
                (currentLanguage === 'en' ? 'Translation Off' : 'Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù…Ø¹Ø·Ù„Ø©');
            
            showNotification(
                autoTranslate ? 
                (currentLanguage === 'en' ? 'Auto-translation enabled' : 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©') :
                (currentLanguage === 'en' ? 'Auto-translation disabled' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©')
            );
        }

        // Update UI elements based on current language
        function updateUI() {
            const t = TRANSLATIONS[currentLanguage];
            
            // Update status
            document.getElementById('statusText').textContent = t.status;
            document.getElementById('aiInput').placeholder = t.placeholder;
            document.getElementById('sendText').textContent = t.send;
            document.getElementById('translationStatus').textContent = t.autoTranslate;
            
            // Update quick actions
            const quickActions = document.querySelectorAll('.quick-action');
            quickActions[0].textContent = t.quickActions.threat;
            quickActions[1].textContent = t.quickActions.vulnerability;
            quickActions[2].textContent = t.quickActions.translate;
            quickActions[3].textContent = t.quickActions.explain;
        }

        // Enhanced AI persona with multilingual support
        function getAIPersona() {
            return `You are Wailand Security AI - an advanced multilingual cybersecurity assistant.

KEY CAPABILITIES:
1. Bilingual Communication: Respond in the same language as the user's query (English or Arabic)
2. Security Expertise: Threat analysis, vulnerability assessment, security policies, incident response
3. Translation: Provide accurate translations when requested
4. Education: Explain complex security concepts in simple terms

RESPONSE GUIDELINES:
- Match the user's language (English/Arabic)
- Provide accurate, actionable security advice
- Offer translations when explicitly requested
- Maintain professional cybersecurity expertise
- Use clear, understandable explanations

Always prioritize security accuracy while being helpful and educational.`;
        }

        // Smart translation system
        async function translateText(text, targetLang) {
            if (!autoTranslate || targetLang === detectLanguage(text)) {
                return text;
            }

            try {
                const prompt = `Translate this cybersecurity-related text to ${targetLang === 'en' ? 'English' : 'Arabic'} while maintaining technical accuracy:

${text}

Provide only the translation without additional explanations.`;
                
                const response = await callGeminiAPI(prompt);
                return response;
            } catch (error) {
                console.warn("Translation failed, returning original text");
                return text;
            }
        }

        // Detect language of text
        function detectLanguage(text) {
            const arabicChars = /[\u0600-\u06FF]/;
            return arabicChars.test(text) ? 'ar' : 'en';
        }

        // Enhanced API call with language support
        async function callGeminiAPI(prompt) {
            try {
                const fullPrompt = `${getAIPersona()}\n\nCurrent conversation context:\n${chatHistory.slice(-3).map(msg => `${msg.role}: ${msg.content}`).join('\n')}\n\nUser: ${prompt}\n\nAI:`;

                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/${CONFIG.model}:generateContent?key=${CONFIG.apiKey}`,
                    {
                        method: "POST",
                        headers: { 
                            "Content-Type": "application/json",
                            "Accept": "application/json"
                        },
                        body: JSON.stringify({
                            contents: [{ 
                                parts: [{ text: fullPrompt }] 
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                topK: 40,
                                topP: 0.95,
                                maxOutputTokens: 1024,
                            }
                        })
                    }
                );

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Invalid API response format");
                }
                
            } catch (error) {
                console.error("API call failed:", error);
                throw error;
            }
        }

        // Main message sending function
        async function sendMessage() {
            const input = document.getElementById("aiInput");
            const chatContainer = document.getElementById("chatContainer");
            const sendButton = document.getElementById("sendButton");
            const message = input.value.trim();

            if (!message) return;

            // Detect input language
            const inputLang = detectLanguage(message);
            
            // Add user message to chat
            addMessageToChat('user', message, inputLang);
            input.value = "";
            sendButton.disabled = true;

            // Add to history
            chatHistory.push({ role: 'user', content: message, lang: inputLang });

            // Show typing indicator
            const typingIndicator = showTypingIndicator();

            try {
                // Get AI response
                const aiResponse = await callGeminiAPI(message);
                
                // Remove typing indicator
                typingIndicator.remove();
                
                // Detect AI response language
                const responseLang = detectLanguage(aiResponse);
                
                // Add AI response to chat
                addMessageToChat('ai', aiResponse, responseLang);
                
                // Add to history
                chatHistory.push({ role: 'ai', content: aiResponse, lang: responseLang });
                
            } catch (error) {
                typingIndicator.remove();
                const errorMsg = currentLanguage === 'en' 
                    ? "I apologize, but I'm experiencing technical difficulties. Please try again in a moment."
                    : "Ø£Ø¹ØªØ°Ø±ØŒ Ø£ÙˆØ§Ø¬Ù‡ ØµØ¹ÙˆØ¨Ø§Øª ØªÙ‚Ù†ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„.";
                addMessageToChat('ai', errorMsg, currentLanguage);
            }

            sendButton.disabled = false;
            input.focus();
        }

        // Add message to chat with language support
        function addMessageToChat(role, content, lang) {
            const chatContainer = document.getElementById("chatContainer");
            const messageDiv = document.createElement("div");
            messageDiv.className = `message ${role}`;
            
            const sender = role === 'user' ? 
                (currentLanguage === 'en' ? 'You' : 'Ø£Ù†Øª') : 
                'Wailand Security AI';
            
            const avatarIcon = role === 'user' ? 'fas fa-user' : 'fas fa-robot';
            
            let translationBadge = '';
            if (role === 'ai' && lang !== currentLanguage && autoTranslate) {
                translationBadge = `<span class="translation-indicator">
                    <i class="fas fa-language"></i>
                    ${lang === 'en' ? 'EN' : 'AR'}
                </span>`;
            }
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="message-header">
                        <div class="message-avatar">
                            <i class="${avatarIcon}"></i>
                        </div>
                        <div class="message-sender">${sender}</div>
                        ${role === 'ai' ? '<div class="security-badge"><i class="fas fa-shield-alt"></i>Expert</div>' : ''}
                        ${translationBadge}
                    </div>
                    <div class="message-content">${content.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            const chatContainer = document.getElementById("chatContainer");
            const typingDiv = document.createElement("div");
            typingDiv.className = "typing-indicator";
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>${currentLanguage === 'en' ? 'Analyzing' : 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„'}</div>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return typingDiv;
        }

        // Quick actions
        function quickAction(action) {
            const input = document.getElementById("aiInput");
            const actions = {
                'threat analysis': currentLanguage === 'en' ? 
                    'Can you analyze potential security threats in my network?' :
                    'Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠ Ø´Ø¨ÙƒØªÙŠØŸ',
                'vulnerability scan': currentLanguage === 'en' ?
                    'What\'s the best approach for vulnerability scanning and management?' :
                    'Ù…Ø§ Ù‡ÙŠ Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© Ù„ÙØ­Øµ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©ØŸ',
                'translate this': currentLanguage === 'en' ?
                    'Can you translate this security document?' :
                    'Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ±Ø¬Ù…Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø£Ù…Ù†ÙŠØŸ',
                'explain security': currentLanguage === 'en' ?
                    'Explain zero-trust architecture in simple terms' :
                    'Ø§Ø´Ø±Ø­ Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø«Ù‚Ø© Ø§Ù„ØµÙØ±ÙŠØ© Ø¨Ù…ØµØ·Ù„Ø­Ø§Øª Ø¨Ø³ÙŠØ·Ø©'
            };
            
            input.value = actions[action] || action;
            input.focus();
        }

        // Show notification
        function showNotification(message) {
            // Simple notification implementation
            console.log("ğŸ””", message);
        }

        // Auto-resize textarea
        document.getElementById('aiInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Enter key to send
        document.getElementById('aiInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>